# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

GitHub Runner Autoscaler is a serverless AWS solution that automatically provisions ephemeral, self-hosted GitHub Actions runners on EC2 instances. It uses Lambda functions to process GitHub webhooks and launches EC2 instances on-demand when workflows require self-hosted runners with the "ephemeral" label.

## Common Commands

### Build
```bash
make build
```
This compiles the Go Lambda function to a Linux ARM64 binary named `bootstrap`.

### Deploy
```bash
sam build
sam deploy --config-env dev  # or prod
```

### Local Development
To test changes locally before deployment:
```bash
go build -o bootstrap main.go
```

## Architecture

The system consists of:
1. **API Gateway** - Receives GitHub webhooks
2. **Lambda Function** (main.go) - Processes webhook events and launches EC2 instances
3. **EC2 Instances** - Ephemeral runners that execute GitHub Actions jobs
4. **Secrets Manager** - Stores GitHub PAT securely

The Lambda function:
- Validates incoming webhooks (must be "queued" workflow jobs with "ephemeral" label)
- Retrieves GitHub PAT from Secrets Manager
- Launches EC2 instances with embedded user data script
- Supports custom instance types via GitHub workflow labels (e.g., `instance-type:m5.large`)

## Key Files

- `main.go` - Lambda handler logic
- `template.yaml` - SAM/CloudFormation infrastructure definition
- `user-data.sh` - EC2 initialization script (embedded in Lambda)
- `samconfig.example.yaml` - Example deployment configuration

## Development Notes

- The Lambda uses ARM64 architecture with 128MB memory
- User data script is embedded at compile time from `user-data.sh`
- Instance types can be specified via workflow labels or default to `c7a.large`
- Instances automatically shut down after 60 minutes or job completion

## Commit Guidelines

- Do not include "Generated by Claude" or "Co-Authored-By: Claude" messages in commits
- Keep commit messages concise and descriptive